<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>AI Data Insight Generator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <nav class="navbar">
        <a href="{{ url_for('home') }}" class="navbar-brand">
            <!-- Icon: Activity -->
            <svg class="icon" viewBox="0 0 24 24">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </svg>
            DataInsight
        </a>
        <div class="nav-links">
            <a href="{{ url_for('home') }}" class="nav-item">Home</a>
            {% if session.get('authenticated') %}
            <a href="{{ url_for('dashboard') }}" class="nav-item">Dashboard</a>
            <a href="{{ url_for('insights') }}" class="nav-item">Insights</a>
            <a href="{{ url_for('data_view') }}" class="nav-item">Data</a>
            <a href="{{ url_for('logout') }}" class="nav-item" style="color: var(--danger);">Logout</a>
            {% else %}
            <a href="{{ url_for('login') }}" class="nav-item">Login</a>
            <a href="{{ url_for('signup') }}" class="nav-item">Sign Up</a>
            {% endif %}
        </div>
        <!-- Theme Toggle -->
        <button id="theme-toggle" class="nav-item"
            style="background: none; border: none; cursor: pointer; display: flex; align-items: center; padding: 0.5rem;"
            title="Toggle Theme">
            <!-- Sun Icon (for Dark Mode - click to switch to Light) -->
            <svg class="icon sun-icon" viewBox="0 0 24 24" style="display: none;">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <!-- Moon Icon (for Light Mode - click to switch to Dark) -->
            <svg class="icon moon-icon" viewBox="0 0 24 24">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
        </button>

    </nav>

    <script>
        const updateThemeIcons = (theme) => {
            const sun = document.querySelector('.sun-icon');
            const moon = document.querySelector('.moon-icon');
            if (theme === 'light') {
                sun.style.display = 'none';
                moon.style.display = 'block';
            } else {
                sun.style.display = 'block';
                moon.style.display = 'none';
            }
        };

        const toggleTheme = () => {
            const current = document.documentElement.getAttribute('data-theme');
            const newTheme = current === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcons(newTheme);
        };

        // Init
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        // Wait for DOM
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
            updateThemeIcons(savedTheme);
        });
    </script>

    <main class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div style="margin-bottom: 1.5rem;">
            {% for category, msg in messages %}
            <div
                style="padding: 1rem; border-radius: 6px; background: rgba(59,130,246,0.1); border: 1px solid rgba(59,130,246,0.2); color: #93c5fd; font-size: 0.9rem;">
                {{ msg }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </main>

    <footer class="footer">
        Made by Moksha
    </footer>

    <!-- Chat Widget -->
    {% if session.get('authenticated') %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">

    <div id="chat-fab" class="chat-fab">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
    </div>

    <div id="chat-window" class="chat-window">
        <div class="chat-header">
            <h4>Data Analyst AI</h4>
            <span id="chat-close" class="chat-close">&times;</span>
        </div>
        <div id="chat-messages" class="chat-messages">
            <!-- Messages will appear here -->
        </div>
        <div class="chat-input-area">
            <input type="text" id="chat-input" placeholder="Ask about your data...">
            <button id="chat-send">
                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
    {% endif %}
</body>

</html>